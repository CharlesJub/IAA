---
title: "R Test - Charlie Jubera"
author: "Charlie Jubera"
output: html_notebook
---

```{r}
library(tidyverse)
```

## Set your working directory and upload the "Auto_MPG_Exam.csv" data. Name your data df_auto. Ensure stringAsFactors=FALSE

```{r}
df_auto <-read.csv("~/Desktop/IAA/Attachments/Auto_MPG_Exam.csv", stringsAsFactors = FALSE)
```

## Create a column named "Car_Make" from the first element of the "Car_Name" variable

```{r}
df_auto$car
df_auto <- df_auto %>% mutate(Car_Make = word(Car_Name, 1))

```

## Update "horsepower to be type numeric

```{r}
df_auto <- df_auto %>% mutate(Horsepower = as.numeric(Horsepower))
```

## Change the type of "Cylinders", "Model_Year", and "Origin" from numeric to character

```{r}
df_auto <-  df_auto %>% mutate(across(c("Cylinders", "Model_Year", "Origin"), as.character))
df_auto %>% head()
```

Question 1. How many unique values of "Car_Make" are there? – (5 points)

37 unique values of Car_Make

```{r}
unique(df_auto$Car_Make) %>% length()
```

Question 2. How many variables in "df_auto" are of type character? – (5 points)

5 variables are type character

```{r}
str(df_auto)
```

```{r}
univariate_analysis <- function(data) {
  if(is.numeric(data) == TRUE){
    histogram <- ggplot(data=data.frame(x=data), aes(x=x)) + geom_histogram()
    return(list('obs'=length(data), 
              'mean'=mean(data, na.rm = TRUE), 
              'stdev'=sd(data, na.rm = TRUE),
              'quartiles'=quantile(data, probs = c(.25,.5,.75), na.rm = TRUE),
              'histogram'=histogram))
  }
  if(is.character(data) == TRUE){
    bar_chart <- ggplot(data=data.frame(x=data), aes(x=x)) + geom_bar()
    return(list('obs'=length(data), 
              'unique_levels'=length(unique(data)), 
              'bar_chart'=bar_chart))
  }
  
  
}
```

## Question 3. Using the function created, what is the 2nd quartile (the median, the 50th percentile) of "MPG"? – (10 points)

23.0

```{r}
univariate_analysis(df_auto$MPG)
```

## Question 4. What is the default number of bins in the histogram for "MPG"? (Hint: once you call the function, you will see this information this information in the console. You can also double check with the documentation of geom_histogram ) – (5 points)

30

## Question 5. Using the function created, what "Model_Year" has the greatest number of observations? – (5 points)

73

```{r}
univariate_analysis(df_auto$Model_Year)
```

## Question 6. Using the function created, what is the standard deviation of "Horsepower"? (Round your answer to 1 decimal place, example: nn.n) – (5 points)

SD of horsepower is 38.5

```{r}
univariate_analysis(df_auto$Horsepower)
```

## Question 7. Using the function created, what is the median of "Displacement"? (Round your answer to 1 decimal place, example: nn.n)

148.50

```{r}
univariate_analysis(df_auto$Displacement)
```

## Question 8. Using the function created, what is the most common number of Cylinders for cars in the data set? – (5 points)

4 Cylinders is the most common

```{r}
univariate_analysis(df_auto$Cylinders)
```

## Question 9. Using the function created, what is the mean of Weight? (Round your answer to 1 decimal place, example: nn.n) – (5 points)

2970.4

```{r}
univariate_analysis(df_auto$Weight)
```

# Part 2

## Read the “Traffic_stops.csv” data into R

```{r}
df_traffic <- read.csv("~/Desktop/IAA/Attachments/Traffic_stops.csv", stringsAsFactors = FALSE)
```

## Create a new column called Birth_Year which has only the year portion of driver_birthdate.

```{r}
library(lubridate)
df_traffic <- df_traffic %>% mutate(Birth_Year = year(mdy(driver_birthdate)))
df_traffic %>% select(Birth_Year, driver_birthdate) %>% head()
```

## Create a new column called Cohort, where we assign everyone born on or after the year 2000 (\>= 2000) to a label “after-2000” and everyone before 2000 (\< 2000) to “pre-2000”

```{r}
df_traffic <-  df_traffic %>%  mutate(Cohort = ifelse(Birth_Year >= 2000, "after-2000", "pre-2000"))
```

## Question 10. List the five most frequent birth years – (10 points)

```{r}
df_traffic %>% count(Birth_Year) %>% slice_max(n, n = 5)
```

## Question 11. How many pre-2000 observations do we have in the data? – (10 points)

211061

```{r}
df_traffic %>% select(Birth_Year, Cohort) %>% head()
table(df_traffic$Cohort)
```

## For each of the driving violations listed in the data, calculate the mean driver age.

```{r}
df_traffic %>% group_by(violation) %>% summarise(mean_age = mean(driver_age, na.rm = TRUE))
```

## Question 12. What is the mean age for Careless driving? (Round your answer to 1 decimal place, example: nn.n) – (10 points)

Careless driving: 35.42 average age

## For each combination of driver gender and the driving violation, calculate the mean driver age

```{r}
df_traffic %>% group_by(violation, driver_gender) %>% 
  filter(is.na(driver_gender) == FALSE) %>% 
  summarise(mean_age = mean(driver_age, na.rm = TRUE))

```

## Question 13. What is the mean age for males with a Seat belt violation? (Round your answer to 1 decimal place, example: nn.n) – (10 points)

Seat belt, male: 38.3 average age

## The new dataframe contains only the violation and weekday column when the stop occurred for female drivers of age greater than 60 that were stopped on a Sunday

```{r}
df_weekday_violation <- df_traffic %>% mutate(weekday_of_stop = wday(mdy(stop_date), label = TRUE, abbr = FALSE)) %>% 
  filter((driver_gender == 'female') & (driver_age > 60) & (weekday_of_stop== "Sunday")) %>% 
  select(violation, weekday_of_stop)
```

## Question 14. How many observations does your new dataframe contains? – (5 points)

407

```{r}
nrow(df_weekday_violation)
```

## Question 15. What is the most frequent driving violation in your new dataframe? – (5 points)

333

```{r}
table(df_weekday_violation$violation)
```
